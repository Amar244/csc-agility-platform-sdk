<project>
  <macrodef name="set-coverage-properties">
    <attribute name="repo-base-dir"/>
    <sequential>
      <property name="coverage.tool.dir"
                value="../coverage-lib"/>
      <property name="coverage.tool.jar" value="cobertura-2.1.1.jar"/>
      <property name="coverage.dir" value="@{repo-base-dir}/coverage"/>
      <property name="coverage.datafile.base" value="cobertura.ser"/>
      <property name="coverage.datafile"
                value="${coverage.dir}/${coverage.datafile.base}"/>
      <property name="coverage.report.dir" value="${coverage.dir}/report"/>
      <property name="coverage.sysproperty.datafile"
                value="net.sourceforge.cobertura.datafile"/>
      <property name="ivy.lib" value="ivy-lib" />

      <!-- Makes the build more verbose. -->
      <property name="coverage.debug" value="false"/>

      <!-- Format for coverage-report. -->
      <property name="coverage.format" value="html"/>

      <!-- Cobertura for runtime, reporting, etc. -->
      <path id="coverage.classpath">
        <fileset dir="${coverage.tool.dir}">
          <include name="${coverage.tool.jar}"/>
        </fileset>
      </path>

      <!-- Cobertura including libs that are only needed for instrumentation -->
      <path id="coverage-lib.classpath">
        <fileset dir="${coverage.tool.dir}">
          <include name="${coverage.tool.jar}"/>
          <include name="servlet-api-2.5*.jar" />
        </fileset>
        <fileset dir="${ivy.lib}">
          <include name="slf4j*.jar"/>
          <include name="logback-classic-1.0.13.jar" />
          <include name="logback-core-1.0.13.jar" />
          <include name="junit-4.11.jar"/>
          <include name="jetty-6.1.26.jar"/>
          <include name="jetty-util-6.1.26.jar"/>
          <include name="hamcrest-core-1.3.jar" />
          <include name="asm-5.0.1.jar" />
          <include name="asm-analysis-5.0.1.jar" />
          <include name="asm-commons-5.0.1.jar" />
          <include name="asm-tree-5.0.1.jar" />
          <include name="asm-util-5.0.1.jar" />
          <include name="jaxen-1.1.4.jar" />
          <include name="oro-2.0.8.jar" />
          <include name="commons-lang3-3.3.2.jar" />
        </fileset>
      </path>
    </sequential>
  </macrodef>

  <macrodef name="initialize-coverage">
    <sequential>
      <mkdir dir="${coverage.dir}"/>
      <taskdef classpathref="coverage-lib.classpath"
               resource="tasks.properties"/>
    </sequential>
  </macrodef>
</project>
